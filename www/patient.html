<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient View - MemoryCare</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="patient-view">
    <!-- Login Modal for Patient -->
    <div id="patientLoginModal" style="display: none !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; background: rgba(0,0,0,0.95) !important; z-index: 99999 !important; justify-content: center !important; align-items: center !important;">
        <div style="background: white; padding: 50px; border-radius: 25px; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 10px 50px rgba(0,0,0,0.5); position: relative;">
            <button onclick="closeLoginAndShowDashboard()" style="position: absolute; top: 10px; right: 15px; background: #f44336; color: white; border: none; font-size: 48px; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; font-weight: bold; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.4);">√ó</button>
            <h2 style="color: #333; font-size: 48px; margin-bottom: 20px;">üîê Patient Login</h2>
            <p style="color: #666; font-size: 24px; margin-bottom: 30px; font-weight: 500;">Enter the reference code provided by your caregiver</p>
            <div class="form-section">
                <div class="form-group">
                    <input type="text" id="patientRefCodeInput" placeholder="Enter Code" style="text-transform: uppercase; font-size: 32px; text-align: center; letter-spacing: 10px; padding: 20px; width: 100%; border: 3px solid #4CAF50; border-radius: 15px; font-family: monospace; font-weight: bold;" maxlength="6">
                </div>
                <button id="patientLoginBtn" class="btn btn-primary" style="width: 100%; font-size: 24px; padding: 20px; background: #4CAF50; color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 20px;">
                    üîì Login
                </button>
            </div>
            <div id="patientLoginMessage" style="margin-top: 20px; text-align: center;"></div>
        </div>
    </div>

    <!-- Emergency SOS Button - Always Visible -->
    <button id="sosButton" class="sos-button">üÜò EMERGENCY</button>
    
    <!-- Debug: Logout/Clear Session Button (bottom right) -->
    <button onclick="localStorage.clear(); location.reload();" style="position: fixed; bottom: 20px; right: 20px; background: #ff9800; color: white; padding: 15px 25px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
        üîÑ Reset Login
    </button>
    
    <!-- Test Alert Sound Button (bottom left) -->
    <button onclick="testAlertSystem()" style="position: fixed; bottom: 20px; left: 20px; background: #4CAF50; color: white; padding: 15px 25px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.2); font-weight: bold;">
        üîî Test Alert Sound
    </button>

    <div class="patient-container">
        <header class="patient-header">
            <div class="header-left" style="display: flex; align-items: center; gap: 15px;">
                <a href="role-selection.html" class="back-btn" style="background: #FF5722 !important; color: white !important; padding: 20px 35px !important; border-radius: 15px !important; text-decoration: none !important; font-size: 28px !important; font-weight: bold !important; border: 5px solid white !important; box-shadow: 0 8px 20px rgba(0,0,0,0.5) !important; z-index: 99999 !important; display: inline-block !important;">üè† HOME</a>
                <h1 id="welcomeMessage">Hello!</h1>
            </div>
            <div class="language-toggle">
                <select id="languageSelector" class="language-selector">
                    <option value="en">üá¨üáß English</option>
                    <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                    <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                    <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                </select>
            </div>
        </header>

        <div class="patient-main">
            <!-- Main Action Buttons -->
            <div class="action-grid">
                
                <!-- Help Me / Lost Button -->
                <button class="action-btn help-btn" id="helpButton">
                    <div class="btn-icon">üó∫Ô∏è</div>
                    <div class="btn-text">
                        <span class="english">HELP ME</span>
                    </div>
                </button>

                <!-- Bathroom Button -->
                <button class="action-btn" id="bathroomButton" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                    <div class="btn-icon">üöª</div>
                    <div class="btn-text">
                        <span class="english">BATHROOM</span>
                    </div>
                </button>

                <!-- Face Recognition Button -->
                <button class="action-btn face-btn" id="faceButton">
                    <div class="btn-icon">üì∏</div>
                    <div class="btn-text">
                        <span class="english">WHO IS THIS?</span>
                    </div>
                </button>

                <!-- My Routine Button -->
                <button class="action-btn routine-btn" id="routineButton">
                    <div class="btn-icon">üìÖ</div>
                    <div class="btn-text">
                        <span class="english">MY ROUTINE</span>
                    </div>
                </button>

                <!-- My Medicines Button -->
                <button class="action-btn medicine-btn" id="medicineButton">
                    <div class="btn-icon">üíä</div>
                    <div class="btn-text">
                        <span class="english">MY MEDICINES</span>
                    </div>
                </button>

                <!-- Important People Button -->
                <button class="action-btn people-btn" id="peopleButton">
                    <div class="btn-icon">üë•</div>
                    <div class="btn-text">
                        <span class="english">PEOPLE I KNOW</span>
                    </div>
                </button>

                <!-- Important Places Button -->
                <button class="action-btn places-btn" id="placesButton">
                    <div class="btn-icon">üè†</div>
                    <div class="btn-text">
                        <span class="english">IMPORTANT PLACES</span>
                    </div>
                </button>
            </div>

            <!-- Current Time Display -->
            <div class="time-display">
                <div id="currentTimePatient"></div>
                <div id="currentDatePatient"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Face Recognition -->
    <div id="faceModal" class="modal">
        <div class="modal-content face-modal-content">
            <button class="modal-close" id="closeFaceModal">√ó</button>
            <h2>
                <span class="english">Who Is This Person?</span>
                <span class="telugu">‡∞à ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø ‡∞é‡∞µ‡∞∞‡±Å?</span>
            </h2>
            <video id="faceVideo" autoplay muted playsinline></video>
            <button id="captureBtn" class="btn btn-large btn-primary">
                <span class="english">üì∏ CAPTURE</span>
                <span class="telugu">üì∏ ‡∞§‡±Ä‡∞Ø‡∞Ç‡∞°‡∞ø</span>
            </button>
            <canvas id="faceCanvas" style="display:none;"></canvas>
            <div id="faceResult"></div>
        </div>
    </div>

    <!-- Modal for Lost/Help Mode -->
    <div id="lostModal" class="modal">
        <div class="modal-content lost-modal-content">
            <div class="lost-header">
                <h1>
                    <span class="language-text" data-lang-key="dont-worry">üó∫Ô∏è DON'T WORRY</span>
                </h1>
            </div>
            <div class="lost-body">
                <p class="large-text language-text" data-lang-key="help-coming">Help is on the way</p>
                
                <div id="lostMapContainer" class="map-container" style="height: 300px; margin: 20px 0; border-radius: 15px; overflow: hidden;"></div>
                <p class="location-info" id="locationInfo">üìç Getting your location...</p>
                
                <div class="direction-arrows">
                    <div class="arrow">‚Üë</div>
                    <div class="instruction language-text" data-lang-key="stay-here">Stay where you are</div>
                </div>
                
                <button id="closeLostModal" class="btn btn-large btn-success">
                    <span class="language-text" data-lang-key="im-okay">I'M OKAY NOW</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Routine -->
    <div id="routineModal" class="modal">
        <div class="modal-content info-modal-content">
            <button class="modal-close" id="closeRoutineModal">√ó</button>
            <h2>
                <span class="english">üìÖ My Daily Routine</span>
                <span class="telugu">üìÖ ‡∞®‡∞æ ‡∞¶‡∞ø‡∞®‡∞ö‡∞∞‡±ç‡∞Ø</span>
            </h2>
            <div id="routineDisplay" class="info-display"></div>
            <button class="btn btn-large btn-primary" id="speakRoutine">
                <span class="english">üîä READ TO ME</span>
                <span class="telugu">üîä ‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø</span>
            </button>
        </div>
    </div>

    <!-- Modal for Medicines -->
    <div id="medicineModal" class="modal">
        <div class="modal-content info-modal-content">
            <button class="modal-close" id="closeMedicineModal">√ó</button>
            <h2>
                <span class="english">üíä My Medicines</span>
                <span class="telugu">üíä ‡∞®‡∞æ ‡∞Æ‡∞Ç‡∞¶‡±Å‡∞≤‡±Å</span>
            </h2>
            <div id="medicineDisplay" class="info-display"></div>
        </div>
    </div>

    <!-- Modal for People -->
    <div id="peopleModal" class="modal">
        <div class="modal-content info-modal-content">
            <button class="modal-close" id="closePeopleModal">√ó</button>
            <h2>
                <span class="english">üë• People I Know</span>
                <span class="telugu">üë• ‡∞®‡∞æ‡∞ï‡±Å ‡∞§‡±Ü‡∞≤‡∞ø‡∞∏‡∞ø‡∞® ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡±Å‡∞≤‡±Å</span>
            </h2>
            <div id="peopleDisplay" class="info-display"></div>
            <button class="btn btn-large btn-primary" id="speakPeople">
                <span class="english">üîä READ TO ME</span>
                <span class="telugu">üîä ‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø</span>
            </button>
        </div>
    </div>

    <!-- Modal for Places -->
    <div id="placesModal" class="modal">
        <div class="modal-content info-modal-content">
            <button class="modal-close" id="closePlacesModal">√ó</button>
            <h2>
                <span class="english">üè† Important Places</span>
                <span class="telugu">üè† ‡∞Æ‡±Å‡∞ñ‡±ç‡∞Ø‡∞Æ‡±à‡∞® ‡∞™‡±ç‡∞∞‡∞¶‡±á‡∞∂‡∞æ‡∞≤‡±Å</span>
            </h2>
            <div id="placesDisplay" class="info-display"></div>
            <button class="btn btn-large btn-primary" id="speakPlaces">
                <span class="english">üîä READ TO ME</span>
                <span class="telugu">üîä ‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø</span>
            </button>
        </div>
    </div>

    <!-- Medicine Reminder Notification -->
    <div id="medicineReminder" class="reminder-notification" style="display:none;">
        <div class="reminder-content">
            <h2>üíä Medicine Time!</h2>
            <div id="reminderMedicineName"></div>
            <div id="reminderMedicineTime"></div>
            <div class="reminder-actions">
                <button id="takeMedicineBtn" class="btn btn-large btn-success">‚úì I TOOK IT</button>
                <button id="snoozeMedicineBtn" class="btn btn-large btn-warning">‚è∞ REMIND LATER</button>
            </div>
        </div>
    </div>

    <!-- Watch Charging Reminder -->
    <div id="watchReminder" class="reminder-notification" style="display:none;">
        <div class="reminder-content">
            <h2>‚åö Watch Charging Time!</h2>
            <p class="large-text english">Please charge your watch now</p>
            <p class="large-text telugu">‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞ó‡∞°‡∞ø‡∞Ø‡∞æ‡∞∞‡∞Ç ‡∞õ‡∞æ‡∞∞‡±ç‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
            <button id="acknowledgeWatchBtn" class="btn btn-large btn-success">‚úì OKAY</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- App Scripts -->
    <!-- firebase-sync.js removed: it was causing JSON.parse errors on reference codes -->
    <script src="permissions-handler.js"></script>
    <script src="background-service.js"></script>
    <script src="cross-browser-sync.js?v=20260106"></script>
    <script src="trigger-monitor.js"></script>
    <script src="indoor-location.js"></script>
    <script src="voice-assistant.js"></script>
    <script src="patient.js?v=20260106"></script>
    <script>
        // Initialize cross-browser sync
        if (typeof initCrossBrowserSync !== 'undefined') {
            initCrossBrowserSync().then(success => {
                if (success) {
                    console.log('‚úÖ Firebase sync active');
                }
            });
        }
    </script>
</body>
</html>
